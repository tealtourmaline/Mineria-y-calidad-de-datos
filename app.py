# -*- coding: utf-8 -*-
"""DESPLIEGUE.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/github/tealtourmaline/Mineria-y-calidad-de-datos/blob/main/DESPLIEGUE.ipynb

# Despliegue
# Dataset: Resultados Saber 11
***Valeria Espinal Alcaraz, Jer贸nimo Valencia Ospina, Natalia Arboleda Arboleda***
- Cargamos el modelo
- Cargamos los datos futuros
- Preparar los datos futuros
- Aplicamos el modelo para la predicci贸n
"""

#Importamos librer铆as b谩sicas
import pandas as pd # manipulacion dataframes
import numpy as np  # matrices y vectores
import matplotlib.pyplot as plt #gr谩fica

#pip install streamlit

import streamlit as st
#Cargamos el modelo
import pickle
filename = 'modelo-knn.pkl'
modelKnn,labelencoder,variables,min_max_scaler = pickle.load(open(filename, 'rb'))

import streamlit as st
import pandas as pd
import pickle

# T铆tulo de la app
st.title('Predicci贸n del nivel de ingl茅s en Saber 11')

st.write("Esta aplicaci贸n predice el nivel de ingl茅s (A1, A2, B1, B+) que obtendr铆a un estudiante en la prueba Saber 11, usando un modelo KNN entrenado.")

# Cargar el modelo KNN, el label encoder, las variables usadas y el escalador
modelo_path = 'modelo-knn.pkl'
modelKnn, labelencoder, variables, min_max_scaler = pickle.load(open(modelo_path, 'rb'))

# Inputs del usuario
st.subheader("Ingrese los datos del estudiante:")

cole_area = st.selectbox('rea de ubicaci贸n del colegio', ['URBANO', 'RURAL'])
cole_bilingue = st.selectbox('驴Colegio biling眉e?', ['S', 'N'])
cole_caracter = st.selectbox('Car谩cter del colegio', ['TCNICO', 'ACADMICO', 'TCNICO/ACADMICO'])
cole_jornada = st.selectbox('Jornada del colegio', ['MAANA', 'TARDE', 'NOCHE', 'COMPLETA'])
edu_madre = st.selectbox('Educaci贸n de la madre', [
    'Ninguno', 'Primaria completa', 'Secundaria (Bachillerato) completa',
    'T茅cnica o tecnol贸gica completa', 'Educaci贸n profesional completa',
    'Educaci贸n profesional incompleta', 'Postgrado'
])
edu_padre = st.selectbox('Educaci贸n del padre', [
    'Ninguno', 'Primaria completa', 'Secundaria (Bachillerato) completa',
    'T茅cnica o tecnol贸gica completa', 'Educaci贸n profesional completa',
    'Educaci贸n profesional incompleta', 'Postgrado'
])
estrato = st.selectbox('Estrato de vivienda', ['Estrato 1', 'Estrato 2', 'Estrato 3', 'Estrato 4', 'Estrato 5', 'Estrato 6'])
automovil = st.selectbox('驴Tiene autom贸vil?', ['Si', 'No'])
computador = st.selectbox('驴Tiene computador?', ['Si', 'No'])
internet = st.selectbox('驴Tiene internet?', ['Si', 'No'])
lavadora = st.selectbox('驴Tiene lavadora?', ['Si', 'No'])
punt_global = st.slider('Puntaje global obtenido', min_value=0, max_value=500, value=300)

# Diccionario con los datos
input_dict = {
    'COLE_AREA_UBICACION': [cole_area],
    'COLE_BILINGUE': [cole_bilingue],
    'COLE_CARACTER': [cole_caracter],
    'COLE_JORNADA': [cole_jornada],
    'FAMI_EDUCACIONMADRE': [edu_madre],
    'FAMI_EDUCACIONPADRE': [edu_padre],
    'FAMI_ESTRATOVIVIENDA': [estrato],
    'FAMI_TIENEAUTOMOVIL': [automovil],
    'FAMI_TIENECOMPUTADOR': [computador],
    'FAMI_TIENEINTERNET': [internet],
    'FAMI_TIENELAVADORA': [lavadora],
    'PUNT_GLOBAL': [punt_global]
}

# Crear DataFrame
input_df = pd.DataFrame(input_dict)

# Convertir columnas categ贸ricas al tipo category para que coincidan con el modelo
for col in input_df.columns:
    if input_df[col].dtype == object:
        input_df[col] = input_df[col].astype('category')

# Escalar la variable num茅rica
input_df[['PUNT_GLOBAL']] = min_max_scaler.transform(input_df[['PUNT_GLOBAL']])

# Reordenar columnas y crear dummies para que coincidan con entrenamiento
input_df = pd.get_dummies(input_df)

# Asegurar que tenga todas las columnas del entrenamiento
for col in variables:
    if col not in input_df.columns:
        input_df[col] = 0
input_df = input_df[variables]  # Reordenar columnas

# Mostrar datos ingresados
st.subheader('Datos procesados:')
st.write(input_df)

# Bot贸n para predecir
if st.button('Predecir nivel de ingl茅s'):
    pred = modelKnn.predict(input_df)[0]
    nivel_ingles = labelencoder.inverse_transform([pred])[0]

    st.subheader('Predicci贸n:')
    st.write(f" El nivel de ingl茅s estimado es: **{nivel_ingles}**")